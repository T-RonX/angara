services:
    app:
        build: ./docker/app/.
        container_name: angara-app
        restart: always
        working_dir: /var/www/html
        volumes:
            - .:/var/www/html
            - /mnt/c/Users/T_Ron/Desktop:/var/www/html/tmp
        networks:
            - angara-network
        ports:
            - '4101:4101'

    web:
        image: nginx:alpine
        container_name: angara-web
        restart: always
        working_dir: /var/www/html
        ports:
            - '4100:80'
        volumes:
            - .:/var/www/html
            - ./docker/web/nginx/conf.d/:/etc/nginx/conf.d/
        networks:
            - angara-network

    db:
        image: mysql:8.4.0
        container_name: angara-db
        restart: always
        environment:
            - MYSQL_DATABASE=angara
            - MYSQL_USER=angara
            - MYSQL_PASSWORD=angara
            - MYSQL_ROOT_PASSWORD=root
        volumes:
            - ./docker/db/mysql/my.cnf:/etc/mysql/conf.d/my.cnf
            - mysql_data:/var/lib/mysql:cached
        ports:
            - '4102:3306'
        networks:
            - angara-network

#    spacetimedb:
#        image: clockworklabs/spacetime:latest
#        container_name: angara-spacetimedb
#        user: 1000:1000
#        restart: always
#        command: start --data-dir=/spacetimedb_data
#        volumes:
#            - ./data/standalone:/usr/src/app/data/standalone
#            - ./data/core:/usr/src/app/data/core
#            - ./data/client-api:/usr/src/app/data/client-api
#            - ./data/lib:/usr/src/app/data/lib
#            - ./data/sats:/usr/src/app/data/sats
#            - ./data/bindings:/usr/src/app/data/bindings
#            - ./data/bindings-macro:/usr/src/app/data/bindings-macro
#            - ./data/bindings-sys:/usr/src/app/data/bindings-sys
#            - ./data/vm:/usr/src/app/data/vm
#            - ./data/metrics:/usr/src/app/data/metrics
#            - ./data/keyfiles:/etc/spacetimedb
#            - /home/developer/spacetimedb_config:/home/spacetime/.config/spacetime
#            - ./spacetimedb_data:/spacetimedb_data
#            - ./rust:/app
#        ulimits:
#            core:
#                soft: -1
#                hard: -1
#        ports:
#            - '3000:3000'
#        networks:
#            - angara-network

networks:
    angara-network:
        driver: bridge

volumes:
    mysql_data:
#    spacetimedb_data:
